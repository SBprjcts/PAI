<div class="card">
    <h2 class="title">Add Expenses</h2>

    <form [formGroup]="form" (ngSubmit)="submitPredict()">
        <div class="form-row">
            <div class="date-field">
                <label>Date</label>
                <input type="date" formControlName="date" id="date" required [class.has-value]="form.get('date')?.value"/>
            </div>

            <div class="amount-field">
                <label>Amount</label>
                <input type="number" formControlName="amount" placeholder="e.g., 123.45" 
                step="0.01" min="0.01" (input)="enforceTwoDecimals($event)" (input)="enforceCharLimit($event, 12)"/>
            </div>

            <div class="vendor-field">
                <label>Vendor</label>
                <input type="text" formControlName="vendor" placeholder="e.g., Amazon" 
                (input)="enforceCharLimit($event, 30)" />
            </div>
        </div>
        
        <div class="field">
            <label>Description</label>
            <textarea formControlName="description" rows="3" placeholder="e.g., Purchase of office supplies"
            (input)="enforceCharLimit($event, 255)"></textarea>
        </div>
         
        <div class="char-counter">
            {{ form.get('description')?.value?.length || 0 }}/255
        </div>
        
        <div class="submit-container"> 
            <button type="submit" [disabled]="loading || !form.valid">Submit</button>
        </div>
        
    </form>

  <div *ngIf="loading" class="muted">Predicting...</div>
    <div *ngIf="error" class="error">{{ error }}</div>

    <div *ngIf="result" class="result" aria-live="polite"> 
        
        <hr class="section-divider">
        
        <h3 class="section-title">Category </h3> 
        
        <div class="predicted-line">
            <span class="label">Predicted category:</span>
            <span class="pill pill-strong">{{ result?.category }} </span>
        </div>

        <!-- ADD: two-column wrapper: chips (left) + manual input (right) -->
        <div class="category-chooser"><!-- ADD -->
            <div class="left"><!-- ADD -->
                <div *ngIf="result.top?.length" class="top-matches">

                    <span class="label">Suggested Categories</span>
            
                    <div class="chip-list" role="listbox" aria-label="Top category matches">
                        <button type="button"
                            class="chip"
                            role="option"
                            *ngFor="let pair of result.top"
                            (click)="quickCorrect(pair[0])">
                            {{ pair[0] }}
                        </button>
                    </div>
                </div>

                <div class="inline-actions">
                    <button type="button" class="btn text" (click)="acceptPrediction()">Looks right</button>
                    <button type="button" class="btn text" (click)="showManual = !showManual">
                        Pick another
                    </button>
                </div>
            </div>

            <!--right col below-->
            
            <form *ngIf="showManual" [formGroup]="correctionForm" (ngSubmit)="submitFeedback()" 
            class="manual-correction right" novalidate>
                <label for="category" class="label">Add category</label>
                
                <div class="input-with-count">
                    <input id="category"
                    type="text"
                    formControlName="category"
                    placeholder="e.g., Office Supplies"
                    [attr.list]="'categoryOptions'"
                    maxlength = "30"
                    autocomplete="off" autocapitalize="words" spellcheck="false"
                    aria-describedby="catHelp catCount"
                    (input)="enforceCharLimit($event, 30); normalizeCategory($event)"  />
                </div>
                    
                <datalist id="categoryOptions">
                    <option *ngFor="let c for allCategories" [value]="c"></option>
                </datalist>
                
                <small id="catHelp" class="muted">Use an existing category name when possible.</small>

                <div class="submit-container">
                    <button type="submit" [disabled]="!canSubmitCorrection">Submit correction</button>
                </div>
            </form>
        </div>
    </div>
</div>
